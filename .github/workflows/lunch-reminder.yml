name: 午餐提醒机器人

on:
  # 手动触发
  workflow_dispatch:
  # 定时触发（每天18:20，UTC时间，需要根据你的时区调整）
  schedule:
    - cron: "35 10 * * *" # UTC 10:20 = 北京时间 18:20
  # 也可以设置为每天多个时间点
  # schedule:
  #   - cron: '0 4 * * *'   # 北京时间 12:00
  #   - cron: '0 5 * * *'   # 北京时间 13:00

jobs:
  send-reminder:
    runs-on: ubuntu-latest
    # 如果设置了 environment，在这里指定环境名称
    # environment: production  # 取消注释并改为你的环境名称

    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 设置 pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      - name: 设置 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "pnpm"

      - name: 安装依赖
        run: pnpm install

      - name: 编译 TypeScript
        run: pnpm run build

      - name: 运行提醒任务
        env:
          # 从 GitHub Secrets 中读取环境变量
          FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
          WEATHER_API_KEY: ${{ secrets.WEATHER_API_KEY }}
          WEATHER_CITY: ${{ secrets.WEATHER_CITY }}
          WEATHER_LAT: ${{ secrets.WEATHER_LAT }}
          WEATHER_LON: ${{ secrets.WEATHER_LON }}
          NEWAPI_TOKEN: ${{ secrets.NEWAPI_TOKEN }}
          NEWAPI_MODEL: ${{ secrets.NEWAPI_MODEL }}
          REMINDER_HOUR: ${{ secrets.REMINDER_HOUR }}
          REMINDER_MINUTE: ${{ secrets.REMINDER_MINUTE }}
        run: pnpm start
